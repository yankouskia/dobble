<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
<title>–î–û–ë–ë–õ–¨ ‚Äî –§–õ–ê–ì–ò</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html, body { height:100%; overflow:hidden; font-family:'Segoe UI',system-ui,sans-serif; background:#1a1a2e; color:#fff; touch-action:manipulation; }

#start-screen { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; gap:20px; background:linear-gradient(135deg,#667eea,#764ba2); }
#start-screen h1 { font-size:3em; text-shadow:3px 3px 6px rgba(0,0,0,.3); }
#start-screen p { font-size:1.2em; opacity:.9; text-align:center; padding:0 20px; text-transform:uppercase; }
.btn { padding:18px 50px; font-size:1.4em; border:none; border-radius:50px; cursor:pointer; font-weight:bold; background:#ff6b6b; color:#fff; box-shadow:0 6px 20px rgba(0,0,0,.3); transition:transform .1s; text-transform:uppercase; }
.btn:active { transform:scale(.95); }

#game-screen { display:none; height:100%; flex-direction:column; }
.player-half { flex:1; position:relative; display:flex; align-items:center; justify-content:center; overflow:hidden; }
.player-half.top { background:linear-gradient(180deg,#0f3460,#16213e); transform:rotate(180deg); }
.player-half.bottom { background:linear-gradient(0deg,#1a1a2e,#0f3460); }
.divider { height:4px; background:linear-gradient(90deg,#ff6b6b,#ffd93d,#6bcb77,#4d96ff); flex-shrink:0; position:relative; z-index:10; }

.score-bar { position:absolute; top:8px; left:0; right:0; display:flex; justify-content:space-between; padding:0 12px; font-size:.9em; font-weight:bold; z-index:5; pointer-events:none; text-transform:uppercase; }
.score-bar .name { background:rgba(255,255,255,.15); padding:4px 12px; border-radius:20px; }

.card-area { width:min(90vw,340px); height:min(42vh,340px); background:radial-gradient(circle,#fff 60%,#e8e8e8); border-radius:50%; position:relative; box-shadow:0 8px 32px rgba(0,0,0,.4); overflow:hidden; }
.flag-btn { position:absolute; background:none; border:none; cursor:pointer; line-height:1; z-index:2; padding:2px; filter:drop-shadow(1px 1px 2px rgba(0,0,0,.2)); }
.flag-btn:active { filter:brightness(1.2) drop-shadow(0 0 8px gold); }
.flag-btn.wrong { animation:shake .4s; }
.flag-btn.correct { animation:pop .4s; }
@keyframes shake { 0%,100%{transform:translateX(0) rotate(var(--rot))} 25%{transform:translateX(-8px) rotate(var(--rot))} 75%{transform:translateX(8px) rotate(var(--rot))} }
@keyframes pop { 0%{transform:scale(1) rotate(var(--rot))} 50%{transform:scale(1.6) rotate(var(--rot))} 100%{transform:scale(1) rotate(var(--rot))} }

/* Celebration overlay */
.celebration { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; z-index:30; pointer-events:none; opacity:0; }
.celebration.show { animation:celebIn 2s forwards; }
@keyframes celebIn { 0%{opacity:0;transform:scale(.3)} 10%{opacity:1;transform:scale(1.1)} 20%{transform:scale(1)} 80%{opacity:1;transform:scale(1)} 100%{opacity:0;transform:scale(.8)} }
.celeb-text { font-size:clamp(1em,4vw,1.6em); font-weight:900; text-align:center; color:#1a1a2e; text-shadow:0 0 10px rgba(255,215,0,.8), 0 0 20px rgba(255,215,0,.4); background:radial-gradient(circle,rgba(255,215,0,.3),transparent 70%); padding:20px; border-radius:20px; text-transform:uppercase; line-height:1.4; }

/* Confetti */
.confetti-container { position:absolute; inset:0; pointer-events:none; z-index:25; overflow:hidden; }
.confetti-piece { position:absolute; width:8px; height:8px; opacity:0; }
@keyframes confettiFall { 0%{opacity:1;transform:translateY(0) rotate(0deg) scale(1)} 100%{opacity:0;transform:translateY(150px) rotate(720deg) scale(0.3)} }

.flash { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:2.5em; font-weight:bold; z-index:20; pointer-events:none; opacity:0; }
.flash.show { animation:flashIn .8s forwards; }
@keyframes flashIn { 0%{opacity:1;transform:scale(2)} 100%{opacity:0;transform:scale(1)} }

#end-screen { display:none; flex-direction:column; align-items:center; justify-content:center; height:100%; gap:16px; background:linear-gradient(135deg,#667eea,#764ba2); text-align:center; padding:20px; }
#end-screen h1 { font-size:2.5em; text-transform:uppercase; }
#end-screen .scores { font-size:1.6em; margin:10px 0; text-transform:uppercase; }
#end-screen .record { font-size:1em; opacity:.7; text-transform:uppercase; }
</style>
</head>
<body>

<div id="start-screen">
  <h1>üÉè –î–û–ë–ë–õ–¨</h1>
  <p>–ù–∞–π–¥–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ñ–ª–∞–≥ –Ω–∞ –¥–≤—É—Ö –∫–∞—Ä—Ç–∞—Ö –±—ã—Å—Ç—Ä–µ–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞!</p>
  <p style="font-size:2.5em">üá´üá∑ üáØüáµ üáßüá∑ üá¶üá∫</p>
  <button class="btn" onclick="startGame()">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
  <p style="font-size:.85em;opacity:.6;max-width:320px">–ü–æ–ª–æ–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –Ω–∞ —Å—Ç–æ–ª –º–µ–∂–¥—É –¥–≤—É–º—è –∏–≥—Ä–æ–∫–∞–º–∏. –ö–∞–∂–¥—ã–π –≤–∏–¥–∏—Ç —Å–≤–æ—é –∫–∞—Ä—Ç—É. –ù–∞–π–¥–∏—Ç–µ –æ–±—â–∏–π —Ñ–ª–∞–≥ –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –Ω–µ–≥–æ!</p>
</div>

<div id="game-screen">
  <div class="player-half top" id="top-half">
    <div class="score-bar"><span class="name" id="score1">–ò–ì–†–û–ö 1: 0</span><span class="name" id="round-top">‚Äî</span></div>
    <div class="card-area" id="card1"></div>
    <div class="celebration" id="celeb1"><div class="celeb-text" id="celeb-text1"></div></div>
    <div class="confetti-container" id="confetti1"></div>
    <div class="flash" id="flash1"></div>
  </div>
  <div class="divider"></div>
  <div class="player-half bottom" id="bot-half">
    <div class="score-bar"><span class="name" id="score2">–ò–ì–†–û–ö 2: 0</span><span class="name" id="round-bot">‚Äî</span></div>
    <div class="card-area" id="card2"></div>
    <div class="celebration" id="celeb2"><div class="celeb-text" id="celeb-text2"></div></div>
    <div class="confetti-container" id="confetti2"></div>
    <div class="flash" id="flash2"></div>
  </div>
</div>

<div id="end-screen">
  <h1 id="winner-text"></h1>
  <div class="scores" id="final-scores"></div>
  <div class="record" id="record-info"></div>
  <button class="btn" onclick="startGame()">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
  <button class="btn" style="background:#4d96ff;font-size:1em;padding:12px 30px" onclick="showStart()">–ú–ï–ù–Æ</button>
</div>

<script>
const FLAGS = [
  'üá¶üá∑','üá¶üá∫','üá¶üáπ','üáßüá™','üáßüá∑','üá®üá¶','üá®üá±','üá®üá≥','üá®üá¥','üá≠üá∑',
  'üá®üáø','üá©üá∞','üá™üá®','üá´üáÆ','üá´üá∑','üá©üá™','üá¨üá∑','üá≠üá∫','üáÆüá∏','üáÆüá≥',
  'üáÆüá©','üáÆüá™','üáÆüá±','üáÆüáπ','üáØüáµ','üá∞üáø','üá∞üá∑','üá±üáª','üá±üáπ','üá±üá∫',
  'üá≤üáΩ','üá≤üá®','üá≥üá±','üá≥üáø','üá≥üá¥','üáµüá¶','üáµüáæ','üáµüá™','üáµüá≠','üáµüá±',
  'üáµüáπ','üá∑üá¥','üá∑üá∫','üá∏üá¨','üá∏üá∞','üá∏üáÆ','üá™üá∏','üá∏üá™','üá®üá≠','üáπüáº',
  'üáπüá≠','üáπüá∑','üá∫üá¶','üá¨üáß','üá∫üá∏','üá∫üáæ','üáªüá≥'
];

// Country name and capital in Russian for each flag (same order as FLAGS)
const FLAG_INFO = [
  ['–ê–†–ì–ï–ù–¢–ò–ù–ê','–ë–£–≠–ù–û–°-–ê–ô–†–ï–°'],['–ê–í–°–¢–†–ê–õ–ò–Ø','–ö–ê–ù–ë–ï–†–†–ê'],['–ê–í–°–¢–†–ò–Ø','–í–ï–ù–ê'],['–ë–ï–õ–¨–ì–ò–Ø','–ë–†–Æ–°–°–ï–õ–¨'],
  ['–ë–†–ê–ó–ò–õ–ò–Ø','–ë–†–ê–ó–ò–õ–ò–ê'],['–ö–ê–ù–ê–î–ê','–û–¢–¢–ê–í–ê'],['–ß–ò–õ–ò','–°–ê–ù–¢–¨–Ø–ì–û'],['–ö–ò–¢–ê–ô','–ü–ï–ö–ò–ù'],
  ['–ö–û–õ–£–ú–ë–ò–Ø','–ë–û–ì–û–¢–ê'],['–•–û–†–í–ê–¢–ò–Ø','–ó–ê–ì–†–ï–ë'],['–ß–ï–•–ò–Ø','–ü–†–ê–ì–ê'],['–î–ê–ù–ò–Ø','–ö–û–ü–ï–ù–ì–ê–ì–ï–ù'],
  ['–≠–ö–í–ê–î–û–†','–ö–ò–¢–û'],['–§–ò–ù–õ–Ø–ù–î–ò–Ø','–•–ï–õ–¨–°–ò–ù–ö–ò'],['–§–†–ê–ù–¶–ò–Ø','–ü–ê–†–ò–ñ'],['–ì–ï–†–ú–ê–ù–ò–Ø','–ë–ï–†–õ–ò–ù'],
  ['–ì–†–ï–¶–ò–Ø','–ê–§–ò–ù–´'],['–í–ï–ù–ì–†–ò–Ø','–ë–£–î–ê–ü–ï–®–¢'],['–ò–°–õ–ê–ù–î–ò–Ø','–†–ï–ô–ö–¨–Ø–í–ò–ö'],['–ò–ù–î–ò–Ø','–ù–¨–Æ-–î–ï–õ–ò'],
  ['–ò–ù–î–û–ù–ï–ó–ò–Ø','–î–ñ–ê–ö–ê–†–¢–ê'],['–ò–†–õ–ê–ù–î–ò–Ø','–î–£–ë–õ–ò–ù'],['–ò–ó–†–ê–ò–õ–¨','–ò–ï–†–£–°–ê–õ–ò–ú'],['–ò–¢–ê–õ–ò–Ø','–†–ò–ú'],
  ['–Ø–ü–û–ù–ò–Ø','–¢–û–ö–ò–û'],['–ö–ê–ó–ê–•–°–¢–ê–ù','–ê–°–¢–ê–ù–ê'],['–Æ–ñ–ù–ê–Ø –ö–û–†–ï–Ø','–°–ï–£–õ'],['–õ–ê–¢–í–ò–Ø','–†–ò–ì–ê'],
  ['–õ–ò–¢–í–ê','–í–ò–õ–¨–ù–Æ–°'],['–õ–Æ–ö–°–ï–ú–ë–£–†–ì','–õ–Æ–ö–°–ï–ú–ë–£–†–ì'],['–ú–ï–ö–°–ò–ö–ê','–ú–ï–•–ò–ö–û'],['–ú–û–ù–ê–ö–û','–ú–û–ù–ê–ö–û'],
  ['–ù–ò–î–ï–†–õ–ê–ù–î–´','–ê–ú–°–¢–ï–†–î–ê–ú'],['–ù–û–í–ê–Ø –ó–ï–õ–ê–ù–î–ò–Ø','–í–ï–õ–õ–ò–ù–ì–¢–û–ù'],['–ù–û–†–í–ï–ì–ò–Ø','–û–°–õ–û'],
  ['–ü–ê–ù–ê–ú–ê','–ü–ê–ù–ê–ú–ê'],['–ü–ê–†–ê–ì–í–ê–ô','–ê–°–£–ù–°–¨–û–ù'],['–ü–ï–†–£','–õ–ò–ú–ê'],['–§–ò–õ–ò–ü–ü–ò–ù–´','–ú–ê–ù–ò–õ–ê'],
  ['–ü–û–õ–¨–®–ê','–í–ê–†–®–ê–í–ê'],['–ü–û–†–¢–£–ì–ê–õ–ò–Ø','–õ–ò–°–°–ê–ë–û–ù'],['–†–£–ú–´–ù–ò–Ø','–ë–£–•–ê–†–ï–°–¢'],['–†–û–°–°–ò–Ø','–ú–û–°–ö–í–ê'],
  ['–°–ò–ù–ì–ê–ü–£–†','–°–ò–ù–ì–ê–ü–£–†'],['–°–õ–û–í–ê–ö–ò–Ø','–ë–†–ê–¢–ò–°–õ–ê–í–ê'],['–°–õ–û–í–ï–ù–ò–Ø','–õ–Æ–ë–õ–Ø–ù–ê'],['–ò–°–ü–ê–ù–ò–Ø','–ú–ê–î–†–ò–î'],
  ['–®–í–ï–¶–ò–Ø','–°–¢–û–ö–ì–û–õ–¨–ú'],['–®–í–ï–ô–¶–ê–†–ò–Ø','–ë–ï–†–ù'],['–¢–ê–ô–í–ê–ù–¨','–¢–ê–ô–ë–≠–ô'],['–¢–ê–ò–õ–ê–ù–î','–ë–ê–ù–ì–ö–û–ö'],
  ['–¢–£–†–¶–ò–Ø','–ê–ù–ö–ê–†–ê'],['–£–ö–†–ê–ò–ù–ê','–ö–ò–ï–í'],['–í–ï–õ–ò–ö–û–ë–†–ò–¢–ê–ù–ò–Ø','–õ–û–ù–î–û–ù'],['–°–®–ê','–í–ê–®–ò–ù–ì–¢–û–ù'],
  ['–£–†–£–ì–í–ê–ô','–ú–û–ù–¢–ï–í–ò–î–ï–û'],['–í–¨–ï–¢–ù–ê–ú','–•–ê–ù–û–ô']
];

function generateDeck(n) {
  const cards = [];
  cards.push(Array.from({length:n+1},(_,i)=>i));
  for(let i=0;i<n;i++){
    const card=[0];
    for(let j=0;j<n;j++) card.push(n+1+i*n+j);
    cards.push(card);
  }
  for(let i=0;i<n;i++){
    for(let j=0;j<n;j++){
      const card=[i+1];
      for(let k=0;k<n;k++) card.push(n+1+k*n+((i*k+j)%n));
      cards.push(card);
    }
  }
  return cards;
}

const DECK = generateDeck(7);
let scores=[0,0], currentPair=0, pairs=[], locked=false;

function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.random()*i+1|0;[a[i],a[j]]=[a[j],a[i]]}return a}

function startGame(){
  document.getElementById('start-screen').style.display='none';
  document.getElementById('end-screen').style.display='none';
  document.getElementById('game-screen').style.display='flex';
  scores=[0,0]; currentPair=0;
  const deck=shuffle([...Array(57).keys()]);
  pairs=[];
  for(let i=0;i+1<deck.length;i+=2) pairs.push([deck[i],deck[i+1]]);
  showRound();
}

function showStart(){
  document.getElementById('end-screen').style.display='none';
  document.getElementById('start-screen').style.display='flex';
}

// Scatter flags randomly inside the circular card, Dobble-style
function renderCard(containerId, cardSymbols, player){
  const el=document.getElementById(containerId);
  el.innerHTML='';
  const shuffledSyms=shuffle([...cardSymbols]);
  // Varying sizes - some big, some medium
  const sizeOptions=[58,48,64,44,56,50,62,42];
  // Pre-generate positions ensuring they stay within circle and don't overlap too much
  const placed=[];
  shuffledSyms.forEach((sym,i)=>{
    const sz=sizeOptions[i];
    let cx,cy,attempts=0;
    // Try to place within circle with some randomness
    do {
      // Random angle and radius within circle (bias toward filling the space)
      const angle=Math.random()*Math.PI*2;
      const maxR = 38 - (sz/4); // keep inside circle, bigger items closer to center
      const r = Math.random() * maxR;
      cx = 50 + r * Math.cos(angle);
      cy = 50 + r * Math.sin(angle);
      attempts++;
    } while(attempts<30 && placed.some(p=>Math.hypot(p.x-cx,p.y-cy)<(sz+p.sz)*0.18));
    placed.push({x:cx,y:cy,sz});

    const rot=(Math.random()*70-35)|0;
    const btn=document.createElement('button');
    btn.className='flag-btn';
    btn.textContent=FLAGS[sym];
    btn.style.fontSize=sz+'px';
    btn.style.left=`calc(${cx}% - ${sz/2}px)`;
    btn.style.top=`calc(${cy}% - ${sz/2}px)`;
    btn.style.transform=`rotate(${rot}deg)`;
    btn.style.setProperty('--rot',rot+'deg');
    btn.style.zIndex=Math.random()>0.5?3:2;
    btn.dataset.sym=sym;
    btn.addEventListener('click',()=>handleTap(player,sym,btn));
    el.appendChild(btn);
  });
}

function findMatch(c1,c2){
  const s=new Set(c1);
  return c2.find(x=>s.has(x));
}

function showRound(){
  if(currentPair>=pairs.length){ endGame(); return; }
  locked=false;
  const [i1,i2]=pairs[currentPair];
  renderCard('card1',DECK[i1],0);
  renderCard('card2',DECK[i2],1);
  updateScores();
}

function spawnConfetti(containerId){
  const container=document.getElementById(containerId);
  container.innerHTML='';
  const colors=['#ff6b6b','#ffd93d','#6bcb77','#4d96ff','#ff9ff3','#feca57','#ff6348','#7bed9f'];
  for(let i=0;i<40;i++){
    const piece=document.createElement('div');
    piece.className='confetti-piece';
    piece.style.left=Math.random()*100+'%';
    piece.style.top=(20+Math.random()*30)+'%';
    piece.style.background=colors[i%colors.length];
    piece.style.borderRadius=Math.random()>0.5?'50%':'2px';
    piece.style.width=(5+Math.random()*8)+'px';
    piece.style.height=(5+Math.random()*8)+'px';
    piece.style.animation=`confettiFall ${0.8+Math.random()*1.2}s ${Math.random()*0.3}s ease-out forwards`;
    container.appendChild(piece);
  }
}

function handleTap(player,sym,btn){
  if(locked) return;
  const [i1,i2]=pairs[currentPair];
  const match=findMatch(DECK[i1],DECK[i2]);
  if(sym===match){
    locked=true;
    scores[player]++;
    btn.classList.add('correct');
    updateScores();

    // Confetti
    spawnConfetti(player===0?'confetti1':'confetti2');

    // Show country + capital
    const info=FLAG_INFO[sym];
    const celebEl=document.getElementById(player===0?'celeb1':'celeb2');
    const textEl=document.getElementById(player===0?'celeb-text1':'celeb-text2');
    textEl.innerHTML=`${FLAGS[sym]}<br>${info[0]} ‚Äî ${info[1]}`;
    celebEl.className='celebration show';

    setTimeout(()=>{
      celebEl.className='celebration';
      document.getElementById(player===0?'confetti1':'confetti2').innerHTML='';
      currentPair++;
      showRound();
    },2000);
  } else {
    btn.classList.add('wrong');
    setTimeout(()=>btn.classList.remove('wrong'),400);
  }
}

function updateScores(){
  document.getElementById('score1').textContent=`–ò–ì–†–û–ö 1: ${scores[0]}`;
  document.getElementById('score2').textContent=`–ò–ì–†–û–ö 2: ${scores[1]}`;
  const r=`${currentPair+1}/${pairs.length}`;
  document.getElementById('round-top').textContent=r;
  document.getElementById('round-bot').textContent=r;
}

function endGame(){
  document.getElementById('game-screen').style.display='none';
  const e=document.getElementById('end-screen');
  e.style.display='flex';
  const w=scores[0]>scores[1]?'üèÜ –ò–ì–†–û–ö 1 –ü–û–ë–ï–î–ò–õ!':scores[1]>scores[0]?'üèÜ –ò–ì–†–û–ö 2 –ü–û–ë–ï–î–ò–õ!':'ü§ù –ù–ò–ß–¨–Ø!';
  document.getElementById('winner-text').textContent=w;
  document.getElementById('final-scores').textContent=`–ò–ì–†–û–ö 1: ${scores[0]} ‚Äî –ò–ì–†–û–ö 2: ${scores[1]}`;
  const hs=JSON.parse(localStorage.getItem('dobble-hs')||'[]');
  const best=Math.max(scores[0],scores[1]);
  hs.push({s:best,d:new Date().toLocaleDateString('ru')});
  hs.sort((a,b)=>b.s-a.s);
  if(hs.length>5)hs.length=5;
  localStorage.setItem('dobble-hs',JSON.stringify(hs));
  document.getElementById('record-info').textContent='–†–ï–ö–û–†–î: '+hs[0].s+' –û–ß–ö–û–í ('+hs[0].d+')';
}
</script>
</body>
</html>
